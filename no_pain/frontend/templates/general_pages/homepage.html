{% extends "shared/base.html" %}

{% block title %}
<title>No Pain</title>
{% endblock %}
{% block page_heading %}{% endblock %}

{% block content %}

{% if user.role == UserRole.PATIENT %}
<!-- PATIENT VIEW -->
<div class="d-flex flex-column flex-md-row-reverse justify-content-between align-items-stretch align-items-md-end gap-3 mt-3 mb-3 border-bottom-desktop">
    <!-- TABS -->
    <div class="d-flex gap-4 border-bottom-mobile mb-0" id="pills-tab" role="tablist">
        <button
            class="btn btn-link text-decoration-none px-0 rounded-0 shadow-none nav-custom-tab active"
            id="pills-doctors-tab" data-bs-toggle="pill" data-bs-target="#pills-doctors" type="button" role="tab"
            aria-controls="pills-doctors" aria-selected="true">Doctors</button>
        <button
            class="btn btn-link text-decoration-none px-0 rounded-0 shadow-none nav-custom-tab"
            id="pills-practices-tab" data-bs-toggle="pill" data-bs-target="#pills-practices" type="button" role="tab"
            aria-controls="pills-practices" aria-selected="false">Practices</button>
    </div>

    <!-- TITLES CONTAINER -->
    <div>
        <div id="header-doctors" class="">
            <h2 class="display-6 mb-0">Registered Doctors</h2>
        </div>
        <div id="header-practices" class="d-none">
            <h2 class="display-6 mb-0">Registered Practices</h2>
        </div>
    </div>
</div>

<div class="tab-content" id="pills-tabContent">
    <!-- DOCTORS TAB -->
    <div class="tab-pane fade show active" id="pills-doctors" role="tabpanel" aria-labelledby="pills-doctors-tab" tabindex="0">
        <div class="list-group list-group-flush mb-3">
            {% for doctor in doctors %}
            {% set slug = doctor.user.first_name ~ "_" ~ doctor.user.last_name %}
            {% set slug = slug.replace(" ", "_") %}
            <a href="/{{ slug }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <span>{{ doctor.user.first_name }} {{ doctor.user.last_name }}</span>
                {% if doctor.specialization %}
                <span class="badge bg-secondary rounded-pill">{{ doctor.specialization }}</span>
                {% endif %}
            </a>
            {% endfor %}
            {% if doctors|length == 0 %}
            <div class="alert alert-info">No doctors found.</div>
            {% endif %}
        </div>
    </div>

    <!-- PRACTICES TAB -->
    <div class="tab-pane fade" id="pills-practices" role="tabpanel" aria-labelledby="pills-practices-tab" tabindex="0">
        <div class="list-group list-group-flush mb-3">
            {% for practice in practices %}
            {% set slug = practice.name.replace(" ", "_") %}
            <a href="/{{ slug }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <span>{{ practice.name }}</span>
                <span class="text-muted small">{{ practice.city }}</span>
            </a>
            {% endfor %}
            {% if practices|length == 0 %}
            <div class="alert alert-info">No practices found.</div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    // Simple script to toggle headers based on tab
    const tabs = document.querySelectorAll('button[data-bs-toggle="pill"]');
    tabs.forEach(tab => {
        tab.addEventListener('shown.bs.tab', event => {
            const targetId = event.target.getAttribute('data-bs-target');
            if (targetId === '#pills-doctors') {
                document.getElementById('header-doctors').classList.remove('d-none');
                document.getElementById('header-practices').classList.add('d-none');
            } else if (targetId === '#pills-practices') {
                document.getElementById('header-doctors').classList.add('d-none');
                document.getElementById('header-practices').classList.remove('d-none');
            }
        })
    })
</script>

{% else %}

<div class="row mt-5">
    <div class="col-md-8 mx-auto text-center">
        <h1 class="display-4">Welcome to No Pain</h1>
        <p class="lead">Manage your practice and patients efficiently.</p>
        <hr class="my-4">
        {% if user.role == UserRole.DOCTOR %}
        <p>You are logged in as a <strong>Doctor</strong>.</p>
        <a class="btn btn-primary btn-lg" href="/user/profile" role="button">View Profile</a>
        {% elif user.role == UserRole.PRACTICE %}
        <p>You are logged in as a <strong>Practice</strong>.</p>
        <a class="btn btn-primary btn-lg" href="/user/profile" role="button">View Profile</a>
        {% else %}
        <p>Welcome back!</p>
        {% endif %}
    </div>
</div>

{% endif %}

{% endblock %}
