<!-- Header -->
{% if not game.running or show_balance %}
{% set col_player = "col-4" %}
{% set col_in = "col-2" %}
{% set col_out = "col-2" %}
{% set col_balance = "col-3" %}
{% set col_arrow = "col-1" %}
{% else %}
{% set col_player = "col-5" %}
{% set col_in = "col-3" %}
{% set col_out = "col-3" %}
{% set col_arrow = "col-1" %}
{% endif %}

<ul class="list-group list-group-flush mb-3 list-group-hover">
    <li class="list-group-item">
        <div class="row fw-bold text-center">
            <div class="{{ col_player }} text-start">
                <a href="?sort=player&order={% if sort_by == 'player' and order == 'asc' %}desc{% else %}asc{% endif %}" class="text-dark text-decoration-none">
                    Player
                    {% if sort_by == 'player' %}
                    <i class="bi bi-caret-{% if order == 'desc' %}down{% else %}up{% endif %}-fill" style="font-size: 0.7em;"></i>
                    {% endif %}
                </a>
            </div>
            <div class="{{ col_in }}">
                <a href="?sort=buy_in&order={% if sort_by == 'buy_in' and order == 'desc' %}asc{% else %}desc{% endif %}" class="text-dark text-decoration-none">
                    In
                    {% if sort_by == 'buy_in' %}
                    <i class="bi bi-caret-{% if order == 'desc' %}down{% else %}up{% endif %}-fill" style="font-size: 0.7em;"></i>
                    {% endif %}
                </a>
            </div>
            <div class="{{ col_out }}">
                <a href="?sort=cash_out&order={% if sort_by == 'cash_out' and order == 'desc' %}asc{% else %}desc{% endif %}" class="text-dark text-decoration-none">
                    Out
                    {% if sort_by == 'cash_out' %}
                    <i class="bi bi-caret-{% if order == 'desc' %}down{% else %}up{% endif %}-fill" style="font-size: 0.7em;"></i>
                    {% endif %}
                </a>
            </div>
            {% if not game.running or show_balance %}
            <div class="{{ col_balance }}">
                <a href="?sort=balance&order={% if sort_by == 'balance' and order == 'desc' %}asc{% else %}desc{% endif %}" class="text-dark text-decoration-none">
                    Balance
                    {% if sort_by == 'balance' %}
                    <i class="bi bi-caret-{% if order == 'desc' %}down{% else %}up{% endif %}-fill" style="font-size: 0.7em;"></i>
                    {% endif %}
                </a>
            </div>
            {% endif %}
            <div class="{{ col_arrow }}"></div>
        </div>
    </li>

    <!-- Players -->
    {% for info in players_info %}

    <li class="list-group-item position-relative">
        <div class="row text-center align-items-center">
            <div class="{{ col_player }} text-start">
                <a href="/team/{{ game.team_id }}/player/{{ info.player.id }}" class="text-decoration-none text-dark fw-semibold stretched-link">
                    {{ info.player.nick }}
                    {% if info.owner %} (host) {% endif %}
                </a>
            </div>

            <div class="{{ col_in }}">
                {% if game.running and info.request_type == 'add_on' %}
                {% if user in info.can_approve %}
                <!-- z-index needed to click button on top of stretched link -->
                <a href="{{ info.request_href }}" class="btn btn-sm btn-outline-danger position-relative" style="z-index: 5;" title="{{ info.request_text }}">
                    <i class="bi bi-exclamation-circle-fill"></i> Add-on
                </a>
                {% else %}
                <span class="badge bg-secondary" title="{{ info.request_text }}">
                    Add-on
                </span>
                {% endif %}
                {% else %}
                <span class="position-relative">
                {% if info.money_in % 1 %}
                {{ "%.2f"|format(info.money_in) }}
                {% else %}
                {{ info.money_in|int }}
                {% endif %}
                {% if is_admin and game.running %}
                <a href="/game/{{ game.id }}/add_on?player_id={{ info.player.id }}" class="ms-1 text-primary position-relative" style="z-index: 5; text-decoration: none;">
                    <i class="bi bi-plus-circle-fill" style="font-size: 1.1rem;"></i>
                </a>
                {% endif %}
                </span>
                {% endif %}
            </div>
            <div class="{{ col_out }}">
                {% if game.running and info.request_type == 'cash_out' %}
                {% if user in info.can_approve %}
                <a href="{{ info.request_href }}" class="btn btn-sm btn-outline-danger position-relative" style="z-index: 5;" title="{{ info.request_text }}">
                    <i class="bi bi-exclamation-circle-fill"></i> Cash-out
                </a>
                {% else %}
                <span class="badge bg-secondary" title="{{ info.request_text }}">
                    Cash-out
                </span>
                {% endif %}
                {% else %}
                <span class="position-relative">
                {% if info.money_out is not none %}
                {% if info.money_out % 1 %}
                {{ "%.2f"|format(info.money_out) }}
                {% else %}
                {{ info.money_out|int }}
                {% endif %}
                {% else %}
                -
                {% endif %}
                {% if is_admin and game.running %}
                <a href="/game/{{ game.id }}/cash_out?player_id={{ info.player.id }}" class="ms-1 text-primary position-relative" style="z-index: 5; text-decoration: none;">
                    <i class="bi bi-plus-circle-fill" style="font-size: 1.1rem;"></i>
                </a>
                {% endif %}
                </span>
                {% endif %}
            </div>

            {% if not game.running or show_balance %}
            <div class="{{ col_balance }} {% if info.balance < 0 %}text-danger{% else %}text-success{% endif %}">
                {{ "%.2f"|format(info.balance) }}
            </div>
            {% endif %}
            
            <div class="{{ col_arrow }} text-end text-muted">
                <i class="bi bi-chevron-right" style="font-size: 0.8rem;"></i>
            </div>

        </div>
    </li>
    {% endfor %}
</ul>